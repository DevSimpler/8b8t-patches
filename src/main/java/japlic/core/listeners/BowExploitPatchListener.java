package japlic.core.listeners;
import org.bukkit.entity.Projectile;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntitySpawnEvent;
import org.bukkit.util.Vector;

public class BowExploitPatchListener implements Listener {
    @EventHandler
    private void onCope(EntitySpawnEvent event) {
        if (event.getEntity() instanceof Projectile) {
            Vector velocity = event.getEntity().getVelocity();

            if (velocity.length() > 3.5) {
                velocity.normalize().multiply(3.5);

                velocity.setX(clamp(velocity.getX(), 3));
                velocity.setY(clamp(velocity.getY(), 3));
                velocity.setZ(clamp(velocity.getZ(), 3));

                event.getEntity().setVelocity(velocity);
            }
        }
    }

    private double clamp(double value, double max) {
        if (value < (double) -3) return -3;
        return Math.min(value, max);
    }
}